import{d as Ce,r,x as O,c as P,I as ke,o as Ve,M as F,C as xe,a as U,b as s,e as t,w as n,f as u,F as G,E as C,g as v,y as H,z as Fe,i as z,j as _,J as De,G as g,A as Me,B as J,m as N,D as W,K as Ie,n as Re,L as $e,N as Be,H as Ee,_ as Ae}from"./index-Ce3jNgTi.js";const Pe={class:"menu-container"},Ue={class:"menu-content"},ze={class:"card-header"},Ne={class:"image-container"},Te=["src","alt"],Le={class:"action-buttons"},Se={class:"pagination-container"},je=["src"],qe={class:"el-upload-list__item-actions"},Ke=["onClick"],Oe=["onClick"],Ge={class:"dialog-footer"},He=["src"],Je=Ce({__name:"MenuView",setup(We){const Q=r(),D=r([]),k=r([]),y=r(!1),M=r(!1),h=r(1),I=r(8),V=r(null),f=r(!1),d=r("add"),b=r(),o=O({id:0,name:"",price:0,category_id:null,image_url:""}),c=r([]),m=r(null),R=r(!1),T=r(""),X=O({name:[{required:!0,message:"메뉴 이름을 입력해주세요",trigger:"blur"},{min:1,max:50,message:"메뉴 이름은 1-50자 이내로 입력해주세요",trigger:"blur"}],price:[{required:!0,message:"가격을 입력해주세요",trigger:"blur"},{type:"number",min:0,message:"가격은 0 이상이어야 합니다",trigger:"blur"}],category_id:[{required:!0,message:"카테고리를 선택해주세요",trigger:"change"}]}),$=(a,e)=>{console.error(e,a);let i=e;a.response&&a.response.data&&(a.response.data.error?i+=`: ${a.response.data.error}`:typeof a.response.data=="string"?i+=`: ${a.response.data}`:a.response.data.message&&(i+=`: ${a.response.data.message}`)),C.error(i)},B=P(()=>!V.value||V.value.length===0?D.value:D.value.filter(a=>V.value.includes(a.category_id))),Y=P(()=>{const a=(h.value-1)*I.value,e=a+I.value;return B.value.slice(a,e)});ke(()=>B.value.length,()=>{h.value=1}),Ve(async()=>{await E()});const E=async()=>{y.value=!0;try{const[a,e]=await Promise.all([F.getMenus(),xe.getAllCategories()]);a.data&&(D.value=a.data),e.data&&(k.value=e.data)}catch(a){$(a,"데이터를 불러오는 중 오류가 발생했습니다")}finally{y.value=!1}},Z=P(()=>k.value.map(a=>({text:a.name,value:a.id}))),L=a=>{const e=k.value.find(i=>i.id===a);return e?e.name:"미분류"},ee=(a,e)=>e.category_id===a,ae=a=>{V.value=a.category_id||[]},le=a=>{h.value=a},S=a=>new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0}).format(a),j=()=>{b.value&&b.value.resetFields(),o.id=0,o.name="",o.price=0,o.category_id=null,o.image_url="",c.value=[],m.value=null},te=()=>{d.value="add",j(),f.value=!0},ne=(a,e)=>{d.value="edit",o.id=e.id,o.name=e.name,o.price=e.price,o.category_id=e.category_id,o.image_url=e.image_url||"",c.value=[],m.value=null,e.image_url&&(c.value=[{name:e.name+"-이미지",url:e.image_url}]),console.log("수정할 메뉴 데이터:",o,"파일 목록:",c.value),f.value=!0},oe=a=>{console.log("이미지 변경:",a,"현재 목록:",c.value),m.value=a.raw;const e=new FileReader;e.onload=i=>{i.target&&i.target.result&&(a.url=i.target.result)},a.raw&&e.readAsDataURL(a.raw)},se=()=>{C.warning("이미지는 하나만 선택할 수 있습니다.")},q=a=>{console.log("이미지 제거:",a),c.value=[],m.value=null},ie=a=>{T.value=a.url||"",R.value=!0},re=async()=>{b.value&&await b.value.validate(async a=>{if(a){M.value=!0;try{const e=new FormData;if(e.append("name",o.name),e.append("price",o.price.toString()),o.category_id!==null&&e.append("category_id",o.category_id.toString()),m.value&&e.append("image",m.value),d.value==="edit"&&(o.image_url&&c.value.length===0||m.value!==null)&&e.append("image_changed","true"),d.value==="add"){console.log("메뉴 추가 요청:",Object.fromEntries(e));const p=await F.createMenu(e);console.log("메뉴 추가 응답:",p),C.success("메뉴가 추가되었습니다.")}else{console.log("메뉴 수정 요청:",Object.fromEntries(e));const p=await F.updateMenu(o.id,e);console.log("메뉴 수정 응답:",p),C.success("메뉴가 수정되었습니다.")}f.value=!1,await E()}catch(e){console.error("API 오류 세부 정보:",e),$(e,`메뉴를 ${d.value==="add"?"추가":"수정"}하는 중 오류가 발생했습니다`)}finally{M.value=!1}}})},ue=a=>{Ee.confirm(`"${a.name}" 메뉴를 삭제하시겠습니까?`,"삭제 확인",{confirmButtonText:"삭제",cancelButtonText:"취소",type:"warning"}).then(()=>{ce(a.id)}).catch(()=>{})},ce=async a=>{y.value=!0;try{await F.deleteMenu(a),C.success("메뉴가 삭제되었습니다."),await E()}catch(e){$(e,"메뉴 삭제 중 오류가 발생했습니다")}finally{y.value=!1}};return(a,e)=>{const i=u("el-icon"),p=u("el-button"),w=u("el-table-column"),de=u("el-popover"),me=u("el-table"),pe=u("el-pagination"),_e=u("el-card"),ge=u("el-input"),x=u("el-form-item"),fe=u("el-input-number"),ve=u("el-option"),ye=u("el-select"),he=u("el-upload"),be=u("el-form"),K=u("el-dialog"),we=Fe("loading");return v(),U(G,null,[s("div",Pe,[s("div",Ue,[t(_e,{shadow:"hover",class:"menu-card"},{header:n(()=>[s("div",ze,[e[8]||(e[8]=s("span",{class:"header-title"},"메뉴 관리",-1)),t(p,{type:"primary",size:"small",onClick:te,class:"add-button"},{default:n(()=>[t(i,{class:"el-icon--left",style:{color:"white"}},{default:n(()=>[t(_(W))]),_:1}),e[7]||(e[7]=N(" 메뉴 추가 "))]),_:1})])]),default:n(()=>[H((v(),z(me,{ref_key:"tableRef",ref:Q,"row-key":"id",data:Y.value,"header-cell-class-name":"table-header",class:"menu-table"},{default:n(()=>[t(w,{label:"이미지","class-name":"image-column",align:"left"},{default:n(l=>[s("div",Ne,[l.row.image_url?(v(),U("img",{key:0,src:l.row.image_url,alt:l.row.name,class:"menu-image"},null,8,Te)):(v(),z(i,{key:1},{default:n(()=>[t(_(De))]),_:1}))])]),_:1}),t(w,{prop:"name",label:"메뉴","class-name":"name-column",align:"left"},{default:n(l=>[t(de,{effect:"light",trigger:"hover",placement:"top",width:"auto"},{default:n(()=>[s("div",null,"이름: "+g(l.row.name),1),s("div",null,"가격: "+g(S(l.row.price)),1),s("div",null,"카테고리: "+g(L(l.row.category_id)),1)]),reference:n(()=>[s("span",null,g(l.row.name),1)]),_:2},1024)]),_:1}),t(w,{prop:"price",label:"가격","class-name":"price-column",align:"left"},{default:n(l=>[s("span",null,g(S(l.row.price)),1)]),_:1}),t(w,{prop:"category_id",label:"카테고리","class-name":"category-column",align:"left",filters:Z.value,"filter-method":ee,"filter-placement":"bottom-end",onFilterChange:ae},{default:n(l=>[s("span",null,g(L(l.row.category_id)),1)]),_:1},8,["filters"]),t(w,{label:"","class-name":"action-column",align:"right"},{default:n(l=>[s("div",Le,[t(i,{class:"action-icon edit-icon",onClick:A=>ne(l.$index,l.row)},{default:n(()=>[t(_(Me))]),_:2},1032,["onClick"]),t(i,{class:"action-icon delete-icon",onClick:A=>ue(l.row)},{default:n(()=>[t(_(J))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[we,y.value]]),s("div",Se,[t(pe,{"current-page":h.value,"onUpdate:currentPage":e[0]||(e[0]=l=>h.value=l),"page-size":I.value,layout:"total, prev, pager, next",total:B.value.length,onCurrentChange:le,"pager-count":5,background:""},null,8,["current-page","page-size","total"])])]),_:1})])]),t(K,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=l=>f.value=l),title:d.value==="add"?"메뉴 추가":"메뉴 편집",width:"40%","close-on-click-modal":!1,onClose:j},{footer:n(()=>[s("span",Ge,[t(p,{onClick:e[4]||(e[4]=l=>f.value=!1)},{default:n(()=>e[9]||(e[9]=[N("취소")])),_:1}),t(p,{type:"primary",onClick:re,loading:M.value},{default:n(()=>[N(g(d.value==="add"?"추가":"저장"),1)]),_:1},8,["loading"])])]),default:n(()=>[t(be,{ref_key:"formRef",ref:b,model:o,rules:X,"label-width":"120px","label-position":"left"},{default:n(()=>[t(x,{label:"메뉴 이름",prop:"name"},{default:n(()=>[t(ge,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=l=>o.name=l),placeholder:"메뉴 이름을 입력하세요",clearable:""},null,8,["modelValue"])]),_:1}),t(x,{label:"가격",prop:"price"},{default:n(()=>[t(fe,{modelValue:o.price,"onUpdate:modelValue":e[2]||(e[2]=l=>o.price=l),min:0,precision:0,step:100,controls:!0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(x,{label:"카테고리",prop:"category_id"},{default:n(()=>[t(ye,{modelValue:o.category_id,"onUpdate:modelValue":e[3]||(e[3]=l=>o.category_id=l),placeholder:"카테고리 선택",style:{width:"100%"},clearable:""},{default:n(()=>[(v(!0),U(G,null,Ie(k.value,l=>(v(),z(ve,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"이미지"},{default:n(()=>[t(he,{class:Re(["menu-image-upload",{"upload-hidden":c.value.length>=1}]),"auto-upload":!1,"show-file-list":!0,limit:1,accept:"image/*","list-type":"picture-card","on-change":oe,"on-remove":q,"file-list":c.value,"on-exceed":se},{file:n(({file:l})=>[s("div",null,[s("img",{class:"el-upload-list__item-thumbnail",src:l.url,alt:""},null,8,je),s("span",qe,[s("span",{class:"el-upload-list__item-preview",onClick:A=>ie(l)},[t(i,null,{default:n(()=>[t(_(Be))]),_:1})],8,Ke),s("span",{class:"el-upload-list__item-delete",onClick:A=>q(l)},[t(i,null,{default:n(()=>[t(_(J))]),_:1})],8,Oe)])])]),default:n(()=>[H(s("div",null,[t(i,null,{default:n(()=>[t(_(W))]),_:1})],512),[[$e,c.value.length<1]])]),_:1},8,["file-list","class"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(K,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=l=>R.value=l),title:"이미지 미리보기"},{default:n(()=>[s("img",{src:T.value,alt:"Preview",style:{"max-width":"100%"}},null,8,He)]),_:1},8,["modelValue"])],64)}}}),Xe=Ae(Je,[["__scopeId","data-v-ccf0a245"]]);export{Xe as default};
