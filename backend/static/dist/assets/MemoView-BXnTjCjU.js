import{d as J,r as y,c as $,o as H,O as P,a as v,b as s,i as S,m as w,S as T,w as l,n as L,e as i,f as r,Q as f,g as c,j as V,B as W,F as B,K as I,U as X,G as u,V as Y,_ as Z}from"./index-AdcA_jBz.js";const ee={class:"order-container"},te={class:"order-header"},se={class:"actions"},oe={class:"card-header"},ne={class:"order-info"},ae={class:"order-items"},le={class:"item-top"},ie={class:"item-name"},re={class:"item-bottom"},ce={class:"item-price"},de={class:"item-total"},ue={class:"order-footer"},_e={class:"order-summary"},me={class:"summary-item"},pe={class:"value"},ve={class:"summary-item"},fe={class:"value"},ge={class:"summary-item total"},he={class:"value price"},ye=J({__name:"MemoView",setup(Se){const g=y([]),k=y([]),h=y([]),b=y([]);let o=null,x=!0;const O=$(()=>d.value.length<=8),d=$(()=>[...g.value].filter(t=>!k.value.includes(t.id)).sort((t,e)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime()));function E(){o!==null&&o.close(),o=new EventSource("/api/orders/stream"),o.onopen=()=>{console.log("SSE 연결 성공"),f({title:"실시간 연결됨",message:"주문 시스템에 실시간으로 연결되었습니다.",type:"success",duration:3e3}),x=!0,setTimeout(()=>{x=!1},3e3)},o.onmessage=t=>{try{const e=JSON.parse(t.data);if(b.value.includes(e.id))return;if(x){b.value.push(e.id);return}const n=g.value.findIndex(_=>_.id===e.id);n!==-1?g.value[n]=e:(g.value.push(e),q([e]),h.value.push(e.id),setTimeout(()=>{h.value=h.value.filter(_=>_!==e.id)},5e3)),b.value.push(e.id)}catch(e){console.error("SSE 메시지 처리 중 오류 발생:",e)}},o.onerror=t=>{console.error("SSE 연결 오류:",t),o&&(o.close(),o=null),f({title:"연결 오류",message:"주문 시스템 연결이 끊겼습니다. 재연결을 시도합니다.",type:"error",duration:5e3}),setTimeout(()=>{console.log("SSE 재연결 시도..."),E()},3e3)}}function q(t){const e=t.map(n=>{const _=n.order_items.map(p=>`${p.menu.name} ${p.quantity}개`).join(", ");return`주문 #${n.id}: ${_}`}).join(`
`);f({title:`새로운 주문 ${t.length}건이 접수되었습니다`,message:e,type:"success",duration:5e3,position:"top-right"})}function z(t){k.value.push(t),f({title:"주문 완료",message:`주문 #${t}이(가) 완료 처리되었습니다.`,type:"success",duration:3e3})}function D(){const t=d.value.map(e=>e.id);k.value.push(...t),f({title:"주문 초기화",message:"모든 주문이 완료 처리되었습니다.",type:"info",duration:3e3})}function j(t){return t.order_items.reduce((e,n)=>e+n.quantity,0)}function F(t){return t<=8?6:t<=16?4:3}function M(t){return new Date(t).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function K(t){return h.value.includes(t)}return H(()=>{E()}),P(()=>{o&&(console.log("SSE 연결 종료"),o.close(),o=null)}),(t,e)=>{const n=r("el-badge"),_=r("el-icon"),p=r("el-button"),Q=r("el-empty"),N=r("el-tag"),R=r("el-scrollbar"),U=r("el-card"),A=r("el-col"),G=r("el-row");return c(),v("div",ee,[s("div",te,[s("h2",null,[e[0]||(e[0]=w("주문 현황 ")),d.value.length>0?(c(),S(n,{key:0,value:d.value.length,type:"primary"},null,8,["value"])):T("",!0)]),s("div",se,[d.value.length>0?(c(),S(p,{key:0,type:"danger",plain:"",size:"small",onClick:D},{default:l(()=>[i(_,null,{default:l(()=>[i(V(W))]),_:1}),e[1]||(e[1]=w(" 모든 주문 지우기 "))]),_:1})):T("",!0)])]),d.value.length===0?(c(),S(Q,{key:0,description:"새로운 주문을 기다리는 중입니다..."})):(c(),v("div",{key:1,class:L(["order-grid",{"two-row-layout":O.value}])},[i(G,{gutter:20},{default:l(()=>[(c(!0),v(B,null,I(d.value,a=>(c(),S(A,{key:a.id,span:F(d.value.length),class:"order-col"},{default:l(()=>[i(U,{class:L(["order-card",{"new-order":K(a.id)}]),shadow:"hover",style:X(O.value?{height:"calc((100vh - 110px) / 2)"}:{})},{header:l(()=>[s("div",oe,[s("div",ne,[i(N,{effect:"dark",size:"large",class:"order-id"},{default:l(()=>[w("#"+u(a.id),1)]),_:2},1024),i(N,{type:"info",size:"small"},{default:l(()=>[w(u(M(a.created_at)),1)]),_:2},1024)]),i(p,{icon:V(Y),circle:"",class:"complete-btn",onClick:C=>z(a.id)},null,8,["icon","onClick"])])]),default:l(()=>{var C;return[s("div",ae,[i(R,{height:O.value?"calc((100vh - 320px) / 2)":"180px"},{default:l(()=>[(c(!0),v(B,null,I(a.order_items,m=>(c(),v("div",{key:`${a.id}-${m.menu.name}`,class:"item"},[s("div",le,[s("span",ie,u(m.menu.name),1),i(n,{value:m.quantity,type:"primary",class:"item-quantity-badge"},null,8,["value"])]),s("div",re,[s("div",ce,u(m.price.toLocaleString())+"원",1),s("div",de,u((m.price*m.quantity).toLocaleString())+"원",1)])]))),128))]),_:2},1032,["height"])]),s("div",ue,[e[5]||(e[5]=s("div",{class:"divider"},null,-1)),s("div",_e,[s("div",me,[e[2]||(e[2]=s("span",{class:"label"},"총 품목:",-1)),s("span",pe,u(a.order_items.length)+"개",1)]),s("div",ve,[e[3]||(e[3]=s("span",{class:"label"},"총 수량:",-1)),s("span",fe,u(j(a))+"개",1)]),s("div",ge,[e[4]||(e[4]=s("span",{class:"label"},"결제 금액:",-1)),s("span",he,u((C=a.total_price)==null?void 0:C.toLocaleString())+"원",1)])])])]}),_:2},1032,["class","style"])]),_:2},1032,["span"]))),128))]),_:1})],2))])}}}),ke=Z(ye,[["__scopeId","data-v-c3ff14fe"]]);export{ke as default};
