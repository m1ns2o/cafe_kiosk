import{g as F}from"./orderApi-7KSuLCiq.js";import{d as M,r as u,c as y,o as R,O as j,a as _,e as a,w as l,g as p,b as m,i as k,P as E,l as h,E as g,h as q,F as W,Q as N,R as J,S as K,v as f,_ as P}from"./index-sjrEs7d5.js";const Q={class:"order-container"},U={class:"order-list-scroll"},A={class:"card-header"},G={key:0},H={key:0,class:"order-total"},X={class:"price"},Y=M({__name:"OrderManageView",setup(Z){const i=u([]),c=u(null),v=u(null),w=u([]),x=u(!0);let o=null;const b=y(()=>[...i.value].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())),n=y(()=>i.value.find(e=>e.id===c.value)||null),T=y(()=>n.value?n.value.order_items:[]);async function I(){try{const e=await F();i.value=e,w.value=e.map(t=>t.id),x.value=!1}catch(e){console.error("주문 목록을 불러오는데 실패했습니다:",e)}}function O(){o!==null&&o.close(),o=new EventSource("/api/orders/stream"),o.onopen=()=>{console.log("SSE 연결")},o.onmessage=e=>{try{const t=JSON.parse(e.data),r=!w.value.includes(t.id),s=i.value.findIndex(d=>d.id===t.id);s!==-1?i.value[s]=t:(i.value.push(t),!x.value&&r&&(C([t]),c.value=t.id,J(()=>{V()}))),r&&w.value.push(t.id)}catch(t){console.error("SSE 메시지 처리 중 오류 발생:",t)}},o.onerror=e=>{console.error("SSE 연결 오류:",e),o&&(o.close(),o=null),setTimeout(()=>{console.log("SSE 재연결 시도..."),O()},3e3)}}function C(e){const t=e.map(r=>{const s=r.order_items.map(d=>`${d.menu.name} ${d.quantity}개`).join(", ");return`주문 #${r.id}: ${s}`}).join(`
`);K({title:`새로운 주문 ${e.length}건이 접수되었습니다`,message:t,type:"success",duration:5e3,position:"top-right"})}function V(){v.value&&v.value.scrollTo(b.value.findIndex(e=>e.id===c.value))}function D(e){c.value=e.id}function L(e){return e.row.id===c.value?"current-row":""}function $(e){return new Date(e).toLocaleString("ko-KR",{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}return R(()=>{I().then(()=>{O()})}),j(()=>{o&&(console.log("SSE 연결 종료"),o.close(),o=null)}),(e,t)=>{const r=p("el-table-column"),s=p("el-card"),d=p("el-col"),z=p("el-empty"),B=p("el-row");return f(),_("div",Q,[a(B,{gutter:24,class:"order-content"},{default:l(()=>[a(d,{xs:24,sm:24,md:8,lg:8},{default:l(()=>[a(s,{shadow:"hover",class:"order-list-card"},{header:l(()=>t[0]||(t[0]=[m("div",{class:"card-header"},"주문 목록",-1)])),default:l(()=>[m("div",U,[a(k(E),{data:b.value,style:{width:"100%"},onRowClick:D,"highlight-current-row":"","row-class-name":L,"header-cell-style":{fontSize:"16px",fontWeight:"bold",background:"#f5f7fa",height:"50px"},"cell-style":{fontSize:"15px",height:"60px"},ref_key:"orderTable",ref:v},{default:l(()=>[a(r,{prop:"id",label:"주문번호",width:"100",align:"center"}),a(r,{prop:"created_at",label:"주문시간","min-width":"150"},{default:l(S=>[h(g($(S.row.created_at)),1)]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1}),a(d,{xs:24,sm:24,md:16,lg:16},{default:l(()=>[a(s,{shadow:"hover",class:"order-detail-card"},{header:l(()=>[m("div",A,[t[1]||(t[1]=h(" 주문 상세 ")),n.value?(f(),_("span",G,"(주문 #"+g(n.value.id)+")",1)):N("",!0)])]),default:l(()=>[n.value?(f(),_(W,{key:1},[a(k(E),{data:T.value,style:{width:"100%"},"header-cell-style":{fontSize:"16px",fontWeight:"bold",background:"#f5f7fa",height:"50px"},"cell-style":{fontSize:"15px",height:"60px"}},{default:l(()=>[a(r,{prop:"menu.name",label:"메뉴명","min-width":"180"}),a(r,{prop:"quantity",label:"수량",width:"100",align:"center"}),a(r,{prop:"price",label:"가격",width:"120",align:"right"},{default:l(S=>[h(g(S.row.price.toLocaleString())+"원 ",1)]),_:1})]),_:1},8,["data"]),n.value.total_price?(f(),_("div",H,[t[2]||(t[2]=h(" 총 주문금액: ")),m("span",X,g(n.value.total_price.toLocaleString())+"원",1)])):N("",!0)],64)):(f(),q(z,{key:0,description:"주문을 선택하세요."}))]),_:1})]),_:1})]),_:1})])}}}),oe=P(Y,[["__scopeId","data-v-3b79ad4a"]]);export{oe as default};
